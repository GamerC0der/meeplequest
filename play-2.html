<style>
body {
    background: url(beach.png) center/cover fixed;
    margin: 0;
    padding: 0;
    min-height: 100vh;
    image-rendering: pixelated;
    image-rendering: crisp-edges;
    position: relative;
}
@keyframes modalFadeIn {
    from { opacity: 0; }
    to { opacity: 1; }
}
@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
    }
}
@keyframes itemFadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}
@keyframes menuPopIn {
    from {
        opacity: 0;
    }
    to {
        opacity: 1;
    }
}
@keyframes dragonFly {
    0% {
        transform: translateX(-50%) translateY(0);
    }
    25% {
        transform: translateX(-20%) translateY(-10px);
    }
    50% {
        transform: translateX(20%) translateY(0);
    }
    75% {
        transform: translateX(50%) translateY(-10px);
    }
    100% {
        transform: translateX(-50%) translateY(0);
    }
}
#inventory-search:focus {
    border-color: rgba(255,215,0,0.8) !important;
}
#inventory-content::-webkit-scrollbar {
    width: 8px;
}
#inventory-content::-webkit-scrollbar-track {
    background: rgba(139,69,19,0.1);
    border-radius: 4px;
}
#inventory-content::-webkit-scrollbar-thumb {
    background: rgba(139,69,19,0.5);
    border-radius: 4px;
}
#inventory-content::-webkit-scrollbar-thumb:hover {
    background: rgba(139,69,19,0.7);
}
.modal-center {
    display: flex;
    justify-content: center;
    align-items: center;
}
#coin-counter {
    user-select: none;
    cursor: move;
    transition: all 0.2s ease;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255,255,255,0.3);
    box-shadow: 0 4px 20px rgba(0,0,0,0.3);
}
#coin-counter:hover {
    transform: scale(1.05);
    box-shadow: 0 6px 25px rgba(0,0,0,0.4);
}
#coin-counter:active {
    cursor: grabbing;
}
#map-btn {
    user-select: none;
    transition: all 0.2s ease;
    backdrop-filter: blur(8px);
    border: 2px solid rgba(255,255,255,0.4);
    box-shadow: 0 4px 15px rgba(0,0,0,0.2);
}
#map-btn:hover {
    transform: scale(1.1);
    border-color: rgba(255,255,255,0.8);
    box-shadow: 0 6px 20px rgba(0,0,0,0.3);
}
#map-btn:active {
    transform: scale(0.95);
}
.current-location {
    color: #FFD700 !important;
    font-weight: bold;
}

@media (max-width: 768px) {
    #zoom-in-btn, #zoom-out-btn {
        width: 50px !important;
        height: 50px !important;
        font-size: 24px !important;
    }

    #zoom-in-btn:hover, #zoom-out-btn:hover {
        transform: none !important;
    }
}
</style>
<div id="coin-counter" style="position: fixed; top: 2%; right: 2%; display: flex; align-items: center; gap: 0.5rem; background: rgba(0,0,0,0.7); padding: 0.5% 1%; border-radius: 10px; color: white; font-size: 1.5vw; z-index: 100; font-family: 'Fredoka One', cursive;">
    <img src="coin.png" alt="Coin" style="width: 2vw; height: 2vw; image-rendering: pixelated;">
    <span id="coin-count">0</span>
</div>
<img id="dragon" src="dragon.png" alt="Dragon" style="position: fixed; top: 1rem; left: 50%; transform: translateX(-50%); width: 400px; height: auto; image-rendering: pixelated; z-index: 99; display: none; animation: dragonFly 8s ease-in-out infinite;">
<img id="player-meeple" src="meeple-blue.png" alt="Player Meeple" style="width: 256px; height: 256px; position: absolute; cursor: pointer; image-rendering: pixelated; z-index: 101;">
<img id="equipped-hat" src="" alt="Equipped Hat" style="width: 64px; height: 64px; position: absolute; image-rendering: pixelated; display: none; pointer-events: none;">
<img id="lighthouse" src="lighthouse.png" alt="Lighthouse" style="width: 500px; height: auto; position: absolute; right: 2rem; top: 50%; transform: translateY(-50%); image-rendering: pixelated;">
<img id="collectible-coin" src="coin.png" alt="Collectible Coin" style="width: 64px; height: 64px; position: absolute; right: 8rem; bottom: 4rem; image-rendering: pixelated; cursor: pointer;">
<img id="market" src="market.png" alt="Market" style="width: 300px; height: auto; position: absolute; left: 50%; top: 20%; transform: translate(-50%, -50%); image-rendering: pixelated; z-index: 98;">
<button id="map-btn" style="position: fixed; right: 2%; bottom: 3%; background: rgba(0,0,0,0.7); border: 2px solid white; border-radius: 10px; padding: 0.5rem; cursor: pointer; z-index: 100;">
    <svg width="2vw" height="2vw" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
        <path d="M20.5 3l-.16.03L15 5.1 9 3 3.36 4.9c-.21.07-.36.25-.36.48V20.5c0 .28.22.5.5.5l.16-.03L9 18.9l6 2.1 5.64-1.9c.21-.07.36-.25.36-.48V3.5c0-.28-.22-.5-.5-.5zM15 19l-6-2.11V5l6 2.11V19z" fill="white"/>
    </svg>
</button>
<div id="welcome-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 2000;" class="modal-center">
    <div style="background: url(textbg.png) center/cover; width: 80%; height: 80%; max-width: 600px; max-height: 400px; border-radius: 20px; position: relative; image-rendering: pixelated; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem;">
        <h1 style="color: #8B4513; font-family: 'Georgia', serif; font-size: 3rem; font-weight: bold; text-transform: uppercase; margin: 0 0 2rem 0; text-shadow: 3px 3px 6px rgba(0,0,0,0.9); -webkit-text-stroke: 1px #2F1B14;">Welcome!</h1>
        <p style="color: #2F1B14; font-family: 'Times New Roman', serif; font-size: 1.2rem; line-height: 1.6; margin: 0 0 2rem 0; text-align: center;">Welcome to the lighthouse! Click the button below to read the latest news.</p>
        <button id="modal-news-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 10px; padding: 1rem 2rem; font-family: 'Fredoka One', cursive; font-size: 1.5rem; font-weight: bold; cursor: pointer; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.3);">üì∞ Read News</button>
        <button id="close-welcome-modal-btn" style="position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive;">√ó</button>
    </div>
</div>
<div id="news-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;" class="modal-center">
    <div style="background: url(textbg.png) center/cover; width: 80%; height: 80%; max-width: 800px; max-height: 600px; border-radius: 20px; position: relative; image-rendering: pixelated;">
        <div style="position: absolute; top: 2rem; left: 50%; transform: translateX(-50%); text-align: center; z-index: 10;">
            <h1 style="color: #2F1B14; font-family: 'Georgia', 'Times New Roman', serif; font-size: 3rem; font-weight: bold; text-shadow: 3px 3px 6px rgba(0,0,0,0.9); margin: 0; text-transform: uppercase; letter-spacing: 0.15em; -webkit-text-stroke: 1px #8B4513;">THE SIEGE TIMES</h1>
            <div style="color: #8B4513; font-family: 'Times New Roman', serif; font-size: 1.2rem; font-weight: bold; margin-top: 0.5rem;">Sep 30, 2025</div>
        </div>
        <button id="prev-page-btn" style="position: absolute; top: 50%; left: 1rem; transform: translateY(-50%); background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; font-weight: bold; cursor: pointer; display: none; z-index: 15;">‚Üê</button>
        <button id="next-page-btn" style="position: absolute; top: 50%; right: 1rem; transform: translateY(-50%); background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 20px; font-weight: bold; cursor: pointer; z-index: 15;">‚Üí</button>
        <div style="position: absolute; bottom: 1rem; left: 50%; transform: translateX(-50%); display: flex; gap: 0.5rem; z-index: 15;">
            <div id="page-dot-1" style="width: 12px; height: 12px; border-radius: 50%; background: white; border: 2px solid #8B4513;"></div>
            <div id="page-dot-2" style="width: 12px; height: 12px; border-radius: 50%; background: rgba(255,255,255,0.5); border: 2px solid #8B4513;"></div>
        </div>
        <div id="news-page-1" style="position: absolute; bottom: 0; left: 0; right: 0; height: 50%; background: rgba(255,255,255,0.95); border-radius: 0 0 20px 20px; padding: 2rem; display: flex; flex-direction: column; align-items: center; justify-content: center;">
            <div style="display: flex; gap: 1rem; margin-bottom: 1rem;">
                <img src="meeple-blue.png" alt="Blue Meeple" style="width: 80px; height: 80px; image-rendering: pixelated;">
                <img src="meeple-green.png" alt="Green Meeple" style="width: 80px; height: 80px; image-rendering: pixelated;">
                <img src="meeple-purple.png" alt="Purple Meeple" style="width: 80px; height: 80px; image-rendering: pixelated;">
                <img src="meeple-red.png" alt="Red Meeple" style="width: 80px; height: 80px; image-rendering: pixelated;">
            </div>
            <h2 style="color: #8B4513; font-family: 'Georgia', serif; font-size: 1.2rem; font-weight: bold; text-transform: uppercase; margin: 0 0 0.5rem 0; text-align: center;">
                The Siege
            </h2>
            <p style="color: #2F1B14; font-family: 'Times New Roman', serif; font-size: 0.9rem; line-height: 1.4; margin: 0; text-align: center; max-width: 400px;">
                The siege has began, and we (us meeples!) are as great as ever. We come in four colors!
            </p>
        </div>
        <div id="news-page-2" style="position: absolute; bottom: 0; left: 0; right: 0; height: 50%; background: rgba(255,255,255,0.95); border-radius: 0 0 20px 20px; padding: 2rem; display: none; flex-direction: column; align-items: center; justify-content: center;">
            <div style="display: flex; align-items: center; margin-bottom: 1rem;">
                <img src="coin.png" alt="Coin" style="width: 60px; height: 60px; image-rendering: pixelated; margin-right: 1rem;">
                <h2 style="color: #8B4513; font-family: 'Georgia', serif; font-size: 1.5rem; font-weight: bold; text-transform: uppercase; margin: 0;">
                    Coins
                </h2>
            </div>
            <p style="color: #2F1B14; font-family: 'Times New Roman', serif; font-size: 0.9rem; line-height: 1.6; margin: 0; text-align: center; max-width: 400px;">
                You can earn coins by completing minigames or walking around the castle. The coins on the castle reset every 30 seconds.
            </p>
        </div>
        <button id="close-modal-btn" style="position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; z-index: 20;">√ó</button>
    </div>
</div>
<div id="map-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
    <div style="position: relative; width: 100%; height: 100%; overflow: hidden;">
        <img id="map-image" src="map.png" alt="Map" style="width: 100%; height: 100%; object-fit: contain; image-rendering: pixelated; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);">
        <div id="market-text" style="position: absolute; top: 25%; left: 30%; color: white; font-family: 'Georgia', serif; font-size: 2.25rem; font-weight: bold; z-index: 15; cursor: pointer; transform-origin: center; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);">Market</div>
        <div id="lighthouse-text" style="position: absolute; top: 15%; left: 34.5%; color: black; font-family: 'Georgia', serif; font-size: 2.25rem; font-weight: bold; z-index: 15; cursor: pointer; transform-origin: center; transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);">Lighthouse</div>
    </div>
    <button id="close-map-modal-btn" style="position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; z-index: 20;">√ó</button>
    <div style="position: absolute; bottom: 1rem; right: 1rem; display: flex; flex-direction: column; gap: 0.5rem; z-index: 25;">
        <button id="zoom-in-btn" style="width: 50px; height: 50px; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; font-size: 24px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; display: flex; align-items: center; justify-content: center;">+</button>
        <button id="zoom-out-btn" style="width: 50px; height: 50px; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; font-size: 24px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; display: flex; align-items: center; justify-content: center;">‚àí</button>
    </div>
</div>
<div id="player-menu" style="display: none; position: absolute; background: url(textbg.png) center/cover; padding: 3rem; border-radius: 15px; image-rendering: pixelated; z-index: 200; box-shadow: 0 4px 12px rgba(0,0,0,0.3); min-width: 200px;">
    <button id="close-player-menu-btn" style="position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 30px; height: 30px; font-size: 18px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive;">√ó</button>
    <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
        <img id="menu-meeple-img" src="meeple-blue.png" alt="Meeple" style="width: 128px; height: 128px; image-rendering: pixelated; display: block;">
        <div style="display: flex; align-items: center; gap: 0.5rem; background: rgba(255,255,255,0.9); padding: 0.5rem 1rem; border-radius: 8px;">
            <img src="coin.png" alt="Coin" style="width: 24px; height: 24px; image-rendering: pixelated;">
            <span style="color: #2F1B14; font-family: 'Georgia', serif; font-size: 1.1rem; font-weight: bold;">Coins: <span id="menu-coin-count">0</span></span>
        </div>
        <button id="inventory-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 0.5rem 1rem; font-family: 'Georgia', serif; font-size: 1rem; font-weight: bold; cursor: pointer;">Inventory</button>
    </div>
</div>
<div id="inventory-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: linear-gradient(135deg, rgba(0,0,0,0.85) 0%, rgba(20,20,20,0.85) 100%); backdrop-filter: blur(8px); z-index: 1200; animation: modalFadeIn 0.3s ease-out;">
    <div style="background: url(textbg.png) center/cover; width: 90%; height: 85%; max-width: 800px; max-height: 650px; border-radius: 24px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) scale(0.95); image-rendering: pixelated; display: flex; flex-direction: column; align-items: center; padding: 2.5rem; box-shadow: 0 25px 50px rgba(0,0,0,0.5), inset 0 1px 0 rgba(255,255,255,0.1); border: 3px solid rgba(139,69,19,0.3); animation: modalSlideIn 0.4s ease-out 0.1s forwards;">
        <button id="close-inventory-modal-btn" style="position: absolute; top: 1.5rem; right: 1.5rem; background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(30,30,30,0.9) 100%); color: white; border: 3px solid rgba(255,255,255,0.8); border-radius: 50%; width: 48px; height: 48px; font-size: 28px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; z-index: 20; transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.3);">&times;</button>
        <h1 style="color: #FFD700; font-family: 'Georgia', serif; font-size: 3rem; font-weight: bold; text-transform: uppercase; margin: 0 0 1.5rem 0; text-shadow: 2px 2px 4px rgba(0,0,0,0.5); -webkit-text-stroke: 1px #8B4513; letter-spacing: 1px;">INVENTORY</h1>
        <div style="position: relative; width: 100%; max-width: 400px; margin-bottom: 2rem;">
            <input type="text" id="inventory-search" placeholder="Search treasures..." style="width: 100%; padding: 1rem 1.5rem; padding-left: 3rem; border: 3px solid rgba(139,69,19,0.6); border-radius: 16px; font-family: 'Georgia', serif; font-size: 1.1rem; background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(250,250,250,0.95) 100%); color: #2F1B14; box-shadow: inset 0 2px 4px rgba(0,0,0,0.1), 0 4px 12px rgba(0,0,0,0.15); transition: all 0.3s ease; outline: none;">
            <div style="position: absolute; left: 1rem; top: 50%; transform: translateY(-50%); color: #8B4513; font-size: 1.2rem;">&#128269;</div>
        </div>
        <div id="inventory-content" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(140px, 1fr)); gap: 1.5rem; width: 100%; max-height: 400px; overflow-y: auto; padding: 0.5rem; scrollbar-width: thin; scrollbar-color: rgba(139,69,19,0.5) transparent;">
        </div>
    </div>
</div>
<div id="item-menu" style="display: none; position: absolute; background: linear-gradient(135deg, rgba(255,255,255,0.95) 0%, rgba(245,245,245,0.95) 100%); padding: 0.75rem; border-radius: 12px; border: 2px solid rgba(139,69,19,0.3); image-rendering: pixelated; z-index: 1300; box-shadow: 0 8px 25px rgba(0,0,0,0.3), 0 0 15px rgba(139,69,19,0.2); backdrop-filter: blur(10px);">
    <div style="display: flex; align-items: center; gap: 0.75rem;">
        <button id="equip-btn" style="background: linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(30,30,30,0.9) 100%); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 0.6rem 1.2rem; font-family: 'Georgia', serif; font-size: 0.9rem; font-weight: bold; cursor: pointer; transition: all 0.2s ease; box-shadow: 0 4px 12px rgba(0,0,0,0.3); text-transform: uppercase; letter-spacing: 0.5px;">Equip</button>
        <button id="close-item-menu-btn" style="background: linear-gradient(135deg, rgba(139,69,19,0.8) 0%, rgba(101,67,33,0.8) 100%); color: white; border: 2px solid rgba(255,255,255,0.8); border-radius: 50%; width: 28px; height: 28px; font-size: 16px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; transition: all 0.2s ease; box-shadow: 0 3px 8px rgba(0,0,0,0.2); display: flex; align-items: center; justify-content: center;">√ó</button>
    </div>
</div>
<div id="crown-award-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1500;" class="modal-center">
    <div style="background: url(textbg.png) center/cover; width: 80%; height: 80%; max-width: 500px; max-height: 400px; border-radius: 20px; position: relative; image-rendering: pixelated; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem;">
        <button id="close-crown-modal-btn" style="position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; z-index: 20;">√ó</button>
        <div style="display: flex; flex-direction: column; align-items: center; gap: 1rem;">
            <img src="crown.png" alt="Crown" style="width: 128px; height: 128px; image-rendering: pixelated;">
            <h1 style="color: #FFD700; font-family: 'Georgia', serif; font-size: 2.5rem; font-weight: bold; text-transform: uppercase; margin: 0; text-align: center; text-shadow: 3px 3px 6px rgba(0,0,0,0.9); -webkit-text-stroke: 1px #2F1B14;">You earned a crown!</h1>
            <p style="color: #2F1B14; font-family: 'Times New Roman', serif; font-size: 1.2rem; line-height: 1.4; margin: 0; text-align: center;">You can equip it from your inventory.</p>
        </div>
    </div>
</div>
<div id="lighthouse-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1500;" class="modal-center">
    <div style="background: url(textbg.png) center/cover; width: 80%; height: 80%; max-width: 600px; max-height: 400px; border-radius: 20px; position: relative; image-rendering: pixelated; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem;">
        <h1 style="color: #8B4513; font-family: 'Georgia', serif; font-size: 3rem; font-weight: bold; text-transform: uppercase; margin: 0 0 2rem 0; text-shadow: 3px 3px 6px rgba(0,0,0,0.9); -webkit-text-stroke: 1px #2F1B14;">LIGHTHOUSE</h1>
        <button id="catch-game-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 1rem 2rem; font-family: 'Georgia', serif; font-size: 1.5rem; font-weight: bold; cursor: pointer; margin-bottom: 1rem;">Catch It</button>
        <button id="fishing-frenzy-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 1rem 2rem; font-family: 'Georgia', serif; font-size: 1.5rem; font-weight: bold; cursor: pointer; margin-bottom: 2rem;">Fishing Frenzy</button>
        <button id="lighthouse-back-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 8px; padding: 0.75rem 1.5rem; font-family: 'Georgia', serif; font-size: 1rem; font-weight: bold; cursor: pointer;">Back</button>
    </div>
</div>
<div id="market-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 1000;">
    <div style="background: url(textbg.png) center/cover; width: 80%; height: 80%; max-width: 800px; max-height: 600px; border-radius: 20px; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); image-rendering: pixelated; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 2rem;">
        <div id="market-tabs" style="position: absolute; top: -40px; left: 50%; transform: translateX(-50%); display: flex; gap: 2px; z-index: 60;">
            <div class="market-tab active" data-tab="shop" style="background: rgba(139, 69, 19, 0.9); color: white; padding: 8px 16px; border-radius: 8px 8px 0 0; cursor: pointer; font-family: 'Georgia', serif; font-size: 0.9rem; font-weight: bold; border: 2px solid #8B4513; border-bottom: none;">SHOP</div>
            <div class="market-tab" data-tab="news" style="background: rgba(139, 69, 19, 0.7); color: white; padding: 8px 16px; border-radius: 8px 8px 0 0; cursor: pointer; font-family: 'Georgia', serif; font-size: 0.9rem; font-weight: bold; border: 2px solid #8B4513; border-bottom: none;">NEWS</div>
        </div>
        <div id="shop-content" class="tab-content active">
            <h1 style="color: #8B4513; font-family: 'Georgia', serif; font-size: 2.5rem; font-weight: bold; text-transform: uppercase; margin: 0 0 2rem 0; text-align: center; text-shadow: 3px 3px 6px rgba(0,0,0,0.9); -webkit-text-stroke: 1px #2F1B14;">SHOP</h1>
            <div style="display: flex; flex-direction: column; gap: 1.5rem; align-items: center;">
                <div style="display: flex; align-items: center; gap: 1rem; background: rgba(255,255,255,0.9); padding: 1rem; border-radius: 10px; width: 300px; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <img src="hat.png" alt="Hat" style="width: 48px; height: 48px; image-rendering: pixelated;">
                        <span style="color: #2F1B14; font-family: 'Georgia', serif; font-size: 1.5rem; font-weight: bold;">Hat</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <img src="coin.png" alt="Coin" style="width: 24px; height: 24px; image-rendering: pixelated;">
                            <span style="color: #8B4513; font-family: 'Georgia', serif; font-size: 1.2rem; font-weight: bold;">$100</span>
                        </div>
                        <button id="hat-buy-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 0.5rem 1rem; font-family: 'Georgia', serif; font-size: 1rem; font-weight: bold; cursor: pointer;">Buy</button>
                    </div>
                </div>
                <div style="display: flex; align-items: center; gap: 1rem; background: rgba(255,255,255,0.9); padding: 1rem; border-radius: 10px; width: 300px; justify-content: space-between;">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <img src="pirate_hat.png" alt="Pirate Hat" style="width: 48px; height: 48px; image-rendering: pixelated;">
                        <span style="color: #2F1B14; font-family: 'Georgia', serif; font-size: 1.5rem; font-weight: bold;">Pirate Hat</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 1rem;">
                        <div style="display: flex; align-items: center; gap: 0.5rem;">
                            <img src="coin.png" alt="Coin" style="width: 24px; height: 24px; image-rendering: pixelated;">
                            <span style="color: #8B4513; font-family: 'Georgia', serif; font-size: 1.2rem; font-weight: bold;">$250</span>
                        </div>
                        <button id="pirate-hat-buy-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 0.5rem 1rem; font-family: 'Georgia', serif; font-size: 1rem; font-weight: bold; cursor: pointer;">Buy</button>
                    </div>
                </div>
            </div>
        </div>
        <div id="news-content" class="tab-content" style="display: none;">
            <div style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100%;">
                <button id="shop-news-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 10px; padding: 1rem 2rem; font-family: 'Fredoka One', cursive; font-size: 1.5rem; font-weight: bold; cursor: pointer; backdrop-filter: blur(10px); box-shadow: 0 4px 20px rgba(0,0,0,0.3);">üì∞ Read News</button>
            </div>
        </div>
        <button id="close-market-modal-btn" style="position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.8); color: white; border: 2px solid white; border-radius: 50%; width: 40px; height: 40px; font-size: 24px; font-weight: bold; cursor: pointer; font-family: 'Fredoka One', cursive; z-index: 20;">√ó</button>
    </div>
</div>
<script>
document.addEventListener('DOMContentLoaded', function() {
    const selectedColor = localStorage.getItem('selectedMeepleColor') || 'blue';
    const meeple = document.getElementById('player-meeple');
    const collectibleCoin = document.getElementById('collectible-coin');
    const coinCountElement = document.getElementById('coin-count');
    const welcomeModal = document.getElementById('welcome-modal');
    const modalNewsBtn = document.getElementById('modal-news-btn');
    const closeWelcomeModalBtn = document.getElementById('close-welcome-modal-btn');
    const shopNewsBtn = document.getElementById('shop-news-btn');
    const mapBtn = document.getElementById('map-btn');
    const mapModal = document.getElementById('map-modal');
    const newsModal = document.getElementById('news-modal');
    const playerMenu = document.getElementById('player-menu');
    const menuMeepleImg = document.getElementById('menu-meeple-img');
    const inventoryBtn = document.getElementById('inventory-btn');
    const closePlayerMenuBtn = document.getElementById('close-player-menu-btn');
    const inventoryModal = document.getElementById('inventory-modal');
    const closeInventoryModalBtn = document.getElementById('close-inventory-modal-btn');
    const inventoryContent = document.getElementById('inventory-content');
    const inventorySearch = document.getElementById('inventory-search');
    const itemMenu = document.getElementById('item-menu');
    const equipBtn = document.getElementById('equip-btn');
    const closeItemMenuBtn = document.getElementById('close-item-menu-btn');
    const equippedHat = document.getElementById('equipped-hat');
    const lighthouse = document.getElementById('lighthouse');
    const market = document.getElementById('market');
    const crownAwardModal = document.getElementById('crown-award-modal');
    const closeCrownModalBtn = document.getElementById('close-crown-modal-btn');
    const lighthouseModal = document.getElementById('lighthouse-modal');
    const catchGameBtn = document.getElementById('catch-game-btn');
    const fishingFrenzyBtn = document.getElementById('fishing-frenzy-btn');
    const lighthouseBackBtn = document.getElementById('lighthouse-back-btn');
    const marketModal = document.getElementById('market-modal');
    const closeMarketModalBtn = document.getElementById('close-market-modal-btn');
    const marketTabs = document.querySelectorAll('.market-tab');
    const hatBuyBtn = document.getElementById('hat-buy-btn');
    const pirateHatBuyBtn = document.getElementById('pirate-hat-buy-btn');
    const zoomInBtn = document.getElementById('zoom-in-btn');
    const zoomOutBtn = document.getElementById('zoom-out-btn');
    const dragon = document.getElementById('dragon');
    if (Math.random() < 0.5) {
        dragon.style.display = 'block';
    }

    function updateMapTransform() {
        const mapImage = document.getElementById('map-image');
        const marketText = document.getElementById('market-text');
        const lighthouseText = document.getElementById('lighthouse-text');
        const transformValue = `scale(${mapScale})`;
        mapImage.style.transform = transformValue;
        if (marketText) marketText.style.transform = transformValue;
        if (lighthouseText) lighthouseText.style.transform = transformValue;
    }

    function zoomIn() {
        if (mapScale < 3) {
            mapScale = Math.min(mapScale * 1.2, 3);
            updateMapTransform();
        }
    }

    function zoomOut() {
        if (mapScale > 0.5) {
            mapScale = Math.max(mapScale / 1.2, 0.5);
            updateMapTransform();
        }
    }
    let selectedItemForEquip = null;
    let currentlyEquippedItem = localStorage.getItem('currentlyEquippedItem') || null;
    let hasEnteredLeftRoom = false;
    let hasEnteredLighthouse = false;
    let hasEnteredMarket = false;
    function updateHatDisplay() {
        if (currentlyEquippedItem) {
            if (currentlyEquippedItem === 'Hat') {
                equippedHat.src = 'hat.png';
            } else if (currentlyEquippedItem === 'Pirate Hat') {
                equippedHat.src = 'pirate_hat.png';
            } else if (currentlyEquippedItem === 'Crown') {
                equippedHat.src = 'crown.png';
            }
            equippedHat.style.display = 'block';
            positionHat();
        } else {
            equippedHat.style.display = 'none';
        }
    }
    function positionHat() {
        if (currentlyEquippedItem && equippedHat.style.display !== 'none') {
            const meepleRect = meeple.getBoundingClientRect();
            equippedHat.style.position = 'fixed';
            equippedHat.style.left = (meepleRect.left + meepleRect.width / 2 - 32) + 'px';
            equippedHat.style.top = (meepleRect.top + 10) + 'px';
            equippedHat.style.zIndex = '100';
        }
    }
    function equipItem(itemName) {
        currentlyEquippedItem = itemName;
        localStorage.setItem('currentlyEquippedItem', itemName);
        updateHatDisplay();
    }
    function unequipItem() {
        currentlyEquippedItem = null;
        localStorage.removeItem('currentlyEquippedItem');
        updateHatDisplay();
    }
    function showLighthouseModal() {
        lighthouseModal.style.display = 'flex';
    }
    const newsPage1 = document.getElementById('news-page-1');
    const newsPage2 = document.getElementById('news-page-2');
    const prevPageBtn = document.getElementById('prev-page-btn');
    const nextPageBtn = document.getElementById('next-page-btn');
    const pageDot1 = document.getElementById('page-dot-1');
    const pageDot2 = document.getElementById('page-dot-2');
    let currentPage = 1;
    const lastCollectedTime = localStorage.getItem('lastCoinCollected');
    if (lastCollectedTime && Date.now() - parseInt(lastCollectedTime) < 30000) {
        collectibleCoin.style.display = 'none';
        const remainingTime = 30000 - (Date.now() - parseInt(lastCollectedTime));
        setTimeout(respawnCoin, remainingTime);
    }
    meeple.src = `meeple-${selectedColor}.png`;
    menuMeepleImg.src = `meeple-${selectedColor}.png`;
    meeple.style.left = '50%';
    meeple.style.top = '50%';
    meeple.style.transform = 'translate(-50%, -50%)';
    setTimeout(() => {
        updateHatDisplay();
    }, 50);
    const crownEarned = localStorage.getItem('crownEarned') === 'true';
    const crownAwardShown = localStorage.getItem('crownAwardShown') === 'true';
    if (crownEarned && !crownAwardShown) {
        crownAwardModal.style.display = 'flex';
        localStorage.setItem('crownAwardShown', 'true');
    }

    const welcomeShown = localStorage.getItem('welcomeShown') === 'true';
    if (!welcomeShown) {
        setTimeout(() => {
            welcomeModal.style.display = 'flex';
            localStorage.setItem('welcomeShown', 'true');
        }, 1000);
    }
    setTimeout(checkProximity, 100);
    const pixelsPerSecond = 600;
    function checkProximity() {
        const meepleRect = meeple.getBoundingClientRect();
        const lighthouseRect = lighthouse.getBoundingClientRect();
        const isOverlappingLighthouse = !(meepleRect.right < lighthouseRect.left ||
                               meepleRect.left > lighthouseRect.right ||
                               meepleRect.bottom < lighthouseRect.top ||
                               meepleRect.top > lighthouseRect.bottom);
        if (isOverlappingLighthouse && !hasEnteredLighthouse) {
            hasEnteredLighthouse = true;
            localStorage.setItem('hasVisitedLighthouse', 'true');
            showLighthouseModal();
            return;
        }
        const marketRect = market.getBoundingClientRect();
        const isOverlappingMarket = !(meepleRect.right < marketRect.left ||
                                     meepleRect.left > marketRect.right ||
                                     meepleRect.bottom < marketRect.top ||
                                     meepleRect.top > marketRect.bottom);
        if (isOverlappingMarket && !hasEnteredMarket) {
            hasEnteredMarket = true;
            marketModal.style.display = 'flex';
            return;
        }
        if (meepleRect.left < window.innerWidth * 0.15 && !hasEnteredLeftRoom) {
            hasEnteredLeftRoom = true;
            window.location.href = '/play.html';
            return;
        }
        checkCoinCollection();
    }
    function checkCoinCollection() {
        if (collectibleCoin.style.display === 'none') return;
        const meepleRect = meeple.getBoundingClientRect();
        const coinRect = collectibleCoin.getBoundingClientRect();
        const isOverlapping = !(meepleRect.right < coinRect.left ||
                               meepleRect.left > coinRect.right ||
                               meepleRect.bottom < coinRect.top ||
                               meepleRect.top > coinRect.bottom);
        if (isOverlapping) {
            collectCoin();
        }
    }
    function collectCoin() {
        collectibleCoin.style.display = 'none';
        localStorage.setItem('lastCoinCollected', Date.now().toString());
        const currentCoins = parseInt(localStorage.getItem('totalCoins') || '0');
        const newCoins = currentCoins + 1;
        localStorage.setItem('totalCoins', newCoins.toString());
        coinCountElement.textContent = newCoins;
        if (playerMenu.style.display === 'block') {
            updatePlayerMenuCoins();
        }
        setTimeout(respawnCoin, Math.random() * 10000 + 5000);
    }
    function respawnCoin() {
        collectibleCoin.style.display = 'block';
    }
    function moveMeeple(targetX, targetY) {
        const playerWidth = 256;
        const playerHeight = 256;
        targetX = Math.max(0, Math.min(targetX, window.innerWidth - playerWidth));
        targetY = Math.max(0, Math.min(targetY, window.innerHeight - playerHeight));
        const rect = meeple.getBoundingClientRect();
        const currentX = rect.left;
        const currentY = rect.top;
        const distance = Math.sqrt(Math.pow(targetX - currentX, 2) + Math.pow(targetY - currentY, 2));
        const duration = distance / pixelsPerSecond;
        meeple.style.transition = `all ${duration}s ease-in-out`;
        meeple.style.left = targetX + 'px';
        meeple.style.top = targetY + 'px';
        meeple.style.transform = 'none';
        if (currentlyEquippedItem) {
            equippedHat.style.transition = `all ${duration}s ease-in-out`;
            equippedHat.style.left = (targetX + meeple.clientWidth / 2 - 32) + 'px';
            equippedHat.style.top = (targetY + 10) + 'px';
        }
        setTimeout(function() {
            checkProximity();
            if (currentlyEquippedItem) {
                equippedHat.style.transition = '';
            }
        }, duration * 1000);
    }
    const totalCoins = parseInt(localStorage.getItem('totalCoins') || '0');
    document.getElementById('coin-count').textContent = totalCoins;

    function makeDraggable(element) {
        let isDragging = false;
        let startX, startY, initialX, initialY, currentX, currentY;

        element.addEventListener('mousedown', function(e) {
            isDragging = true;
            startX = e.clientX;
            startY = e.clientY;
            const rect = element.getBoundingClientRect();
            initialX = rect.left;
            initialY = rect.top;
            currentX = initialX;
            currentY = initialY;
            element.style.cursor = 'grabbing';
            element.style.position = 'fixed';
        });

        function updatePosition(e) {
            if (!isDragging) return;
            const dx = e.clientX - startX;
            const dy = e.clientY - startY;
            currentX = initialX + dx;
            currentY = initialY + dy;
            const elementRect = element.getBoundingClientRect();
            const elementWidth = elementRect.width;
            const elementHeight = elementRect.height;
            currentX = Math.max(0, Math.min(currentX, window.innerWidth - elementWidth));
            currentY = Math.max(0, Math.min(currentY, window.innerHeight - elementHeight));
            element.style.left = currentX + 'px';
            element.style.top = currentY + 'px';
            element.style.right = 'auto';
            requestAnimationFrame(() => updatePosition(e));
        }

        document.addEventListener('mousemove', function(e) {
            if (isDragging) updatePosition(e);
        });

        document.addEventListener('mouseup', function() {
            isDragging = false;
            element.style.cursor = 'move';
        });
    }

    makeDraggable(document.getElementById('coin-counter'));
    makeDraggable(document.getElementById('map-btn'));

    function updatePlayerMenuCoins() {
        const currentCoins = parseInt(localStorage.getItem('totalCoins') || '0');
        document.getElementById('menu-coin-count').textContent = currentCoins;
    }
    function updateInventoryDisplay(searchTerm = '') {
        inventoryContent.innerHTML = '';
        const hatPurchased = localStorage.getItem('hatPurchased') === 'true';
        const pirateHatPurchased = localStorage.getItem('pirateHatPurchased') === 'true';
        const crownEarned = localStorage.getItem('crownEarned') === 'true';
        const items = [];
        if (hatPurchased) {
            items.push({ name: 'Hat', img: 'hat.png', rarity: 'common' });
        }
        if (pirateHatPurchased) {
            items.push({ name: 'Pirate Hat', img: 'pirate_hat.png', rarity: 'rare' });
        }
        if (crownEarned) {
            items.push({ name: 'Crown', img: 'crown.png', rarity: 'legendary' });
        }
        const filteredItems = items.filter(item =>
            item.name.toLowerCase().includes(searchTerm.toLowerCase())
        );
        if (filteredItems.length === 0) {
            const noItemsDiv = document.createElement('div');
            noItemsDiv.style.gridColumn = '1 / -1';
            noItemsDiv.style.textAlign = 'center';
            noItemsDiv.style.padding = '3rem';
            noItemsDiv.innerHTML = `
                <div style="color: #8B4513; font-family: 'Georgia', serif; font-size: 1.2rem; font-style: italic; text-shadow: 1px 1px 2px rgba(0,0,0,0.5);">
                    ${searchTerm ? 'No treasures match your search' : 'No treasures collected yet'}
                </div>
                <div style="color: #666; font-family: 'Georgia', serif; font-size: 0.9rem; margin-top: 0.5rem;">
                    ${searchTerm ? 'Try a different search term' : 'Complete quests and games to earn items!'}
                </div>
            `;
            inventoryContent.appendChild(noItemsDiv);
        } else {
            filteredItems.forEach((item, index) => {
                const itemDiv = document.createElement('div');
                const isEquipped = currentlyEquippedItem === item.name;
                const rarityColors = {
                    common: { bg: 'linear-gradient(135deg, rgba(220,220,220,0.9) 0%, rgba(200,200,200,0.9) 100%)', border: 'rgba(150,150,150,0.8)', glow: 'rgba(150,150,150,0.3)' },
                    rare: { bg: 'linear-gradient(135deg, rgba(220,220,220,0.9) 0%, rgba(200,200,200,0.9) 100%)', border: 'rgba(150,150,150,0.8)', glow: 'rgba(150,150,150,0.3)' },
                    legendary: { bg: 'linear-gradient(135deg, rgba(220,220,220,0.9) 0%, rgba(200,200,200,0.9) 100%)', border: 'rgba(150,150,150,0.8)', glow: 'rgba(150,150,150,0.3)' }
                };
                const colors = rarityColors[item.rarity] || rarityColors.common;
                itemDiv.style.background = colors.bg;
                itemDiv.style.border = `3px solid ${colors.border}`;
                itemDiv.style.borderRadius = '16px';
                itemDiv.style.padding = '1.5rem 1rem';
                itemDiv.style.cursor = 'pointer';
                itemDiv.style.boxShadow = isEquipped ? `0 0 15px ${colors.glow}, 0 4px 12px rgba(0,0,0,0.2)` : '0 4px 12px rgba(0,0,0,0.2)';
                itemDiv.style.position = 'relative';
                itemDiv.style.overflow = 'hidden';
                itemDiv.style.animation = `itemFadeIn 0.3s ease-out ${index * 0.05}s both`;
                if (isEquipped) {
                    itemDiv.style.borderColor = '#FFD700';
                    itemDiv.innerHTML = `
                        <div style="position: absolute; top: 8px; right: 8px; background: #FFD700; color: #8B4513; border-radius: 50%; width: 24px; height: 24px; display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; box-shadow: 0 2px 4px rgba(0,0,0,0.2);">‚úì</div>
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.75rem;">
                            <img src="${item.img}" alt="${item.name}" style="width: 64px; height: 64px; image-rendering: pixelated; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">
                            <div style="text-align: center;">
                                <div style="color: #2F1B14; font-family: 'Georgia', serif; font-size: 1rem; font-weight: bold; margin-bottom: 0.25rem;">${item.name}</div>
                                <div style="color: #FFD700; font-family: 'Georgia', serif; font-size: 0.8rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px;">Equipped</div>
                            </div>
                        </div>
                    `;
                } else {
                    itemDiv.innerHTML = `
                        <div style="display: flex; flex-direction: column; align-items: center; gap: 0.75rem;">
                            <img src="${item.img}" alt="${item.name}" style="width: 64px; height: 64px; image-rendering: pixelated; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.2));">
                            <div style="text-align: center;">
                                <div style="color: #2F1B14; font-family: 'Georgia', serif; font-size: 1rem; font-weight: bold;">${item.name}</div>
                                <div style="color: ${colors.border}; font-family: 'Georgia', serif; font-size: 0.75rem; font-weight: bold; text-transform: uppercase; letter-spacing: 0.5px; margin-top: 0.25rem;">${item.rarity}</div>
                            </div>
                        </div>
                    `;
                }
                itemDiv.addEventListener('click', function(event) {
                    event.stopPropagation();
                    selectedItemForEquip = item.name;
                    const rect = itemDiv.getBoundingClientRect();
                    const modalRect = inventoryModal.getBoundingClientRect();
                    itemMenu.style.left = (rect.left - modalRect.left + rect.width / 2 - 75) + 'px';
                    itemMenu.style.top = (rect.top - modalRect.top - 60) + 'px';
                    if (currentlyEquippedItem === item.name) {
                        equipBtn.textContent = 'Unequip';
                        equipBtn.style.background = 'linear-gradient(135deg, rgba(139,69,19,0.9) 0%, rgba(101,67,33,0.9) 100%)';
                        equipBtn.style.borderColor = '#654321';
                        equipBtn.style.boxShadow = '0 4px 12px rgba(139,69,19,0.4)';
                    } else {
                        equipBtn.textContent = 'Equip';
                        equipBtn.style.background = 'linear-gradient(135deg, rgba(0,0,0,0.9) 0%, rgba(30,30,30,0.9) 100%)';
                        equipBtn.style.borderColor = '#8B4513';
                        equipBtn.style.boxShadow = '0 4px 12px rgba(0,0,0,0.4)';
                    }
                    itemMenu.style.display = 'block';
                    itemMenu.style.animation = 'menuPopIn 0.2s ease-out';
                });
                inventoryContent.appendChild(itemDiv);
            });
        }
    }
    inventoryBtn.addEventListener('click', function() {
        updateInventoryDisplay();
        inventoryModal.style.display = 'flex';
    });
    meeple.addEventListener('click', function(event) {
        event.stopPropagation();
        if (playerMenu.style.display === 'none' || playerMenu.style.display === '') {
            const meepleRect = meeple.getBoundingClientRect();
            playerMenu.style.left = (meepleRect.right + 20) + 'px';
            playerMenu.style.top = (meepleRect.top - 50) + 'px';
            updatePlayerMenuCoins();
            playerMenu.style.display = 'block';
        } else {
            playerMenu.style.display = 'none';
        }
    });
    closePlayerMenuBtn.addEventListener('click', function() {
        playerMenu.style.display = 'none';
    });
    closeInventoryModalBtn.addEventListener('click', function() {
        inventoryModal.style.display = 'none';
        itemMenu.style.display = 'none';
    });
    inventoryModal.addEventListener('click', function(event) {
        if (event.target === inventoryModal) {
            inventoryModal.style.display = 'none';
        }
    });
    inventorySearch.addEventListener('input', function() {
        updateInventoryDisplay(this.value);
        itemMenu.style.display = 'none';
    });
    equipBtn.addEventListener('click', function() {
        if (selectedItemForEquip) {
            if (currentlyEquippedItem === selectedItemForEquip) {
                unequipItem();
                alert(`Unequipped ${selectedItemForEquip}!`);
            } else {
                equipItem(selectedItemForEquip);
                alert(`Equipped ${selectedItemForEquip}!`);
            }
            itemMenu.style.display = 'none';
            selectedItemForEquip = null;
        }
    });
    closeItemMenuBtn.addEventListener('click', function() {
        itemMenu.style.display = 'none';
        selectedItemForEquip = null;
    });
    closeCrownModalBtn.addEventListener('click', function() {
        crownAwardModal.style.display = 'none';
    });
    welcomeModal.addEventListener('click', function(event) {
        if (event.target === welcomeModal) {
            welcomeModal.style.display = 'none';
        }
    });
    crownAwardModal.addEventListener('click', function(event) {
        if (event.target === crownAwardModal) {
            crownAwardModal.style.display = 'none';
        }
    });
    catchGameBtn.addEventListener('click', function() {
        window.location.href = '/arcade-1.html';
    });
    fishingFrenzyBtn.addEventListener('click', function() {
        window.location.href = '/fishing-frenzy-menu.html';
    });
    lighthouseBackBtn.addEventListener('click', function() {
        lighthouseModal.style.display = 'none';
        hasEnteredLighthouse = false;
    });
    lighthouseModal.addEventListener('click', function(event) {
        if (event.target === lighthouseModal) {
            lighthouseModal.style.display = 'none';
            hasEnteredLighthouse = false;
        }
    });
    hatBuyBtn.addEventListener('click', function() {
        const currentCoins = parseInt(localStorage.getItem('totalCoins') || '0');
        if (currentCoins >= 100) {
            localStorage.setItem('totalCoins', (currentCoins - 100).toString());
            localStorage.setItem('hatPurchased', 'true');
            coinCountElement.textContent = currentCoins - 100;
            alert('Hat purchased! Check your inventory.');
        } else {
            alert('Not enough coins! You need $100.');
        }
    });
    pirateHatBuyBtn.addEventListener('click', function() {
        const currentCoins = parseInt(localStorage.getItem('totalCoins') || '0');
        if (currentCoins >= 250) {
            localStorage.setItem('totalCoins', (currentCoins - 250).toString());
            localStorage.setItem('pirateHatPurchased', 'true');
            coinCountElement.textContent = currentCoins - 250;
            alert('Pirate Hat purchased! Check your inventory.');
        } else {
            alert('Not enough coins! You need $250.');
        }
    });
    closeMarketModalBtn.addEventListener('click', function() {
        marketModal.style.display = 'none';
        hasEnteredMarket = false;
    });
    marketModal.addEventListener('click', function(event) {
        if (event.target === marketModal) {
            marketModal.style.display = 'none';
            hasEnteredMarket = false;
        }
    });
    marketTabs.forEach(tab => {
        tab.addEventListener('click', function() {
            const targetTab = this.getAttribute('data-tab');
            marketTabs.forEach(t => {
                t.classList.remove('active');
                t.style.background = 'rgba(139, 69, 19, 0.7)';
            });
            this.classList.add('active');
            this.style.background = 'rgba(139, 69, 19, 0.9)';
            const tabContents = document.querySelectorAll('.tab-content');
            tabContents.forEach(content => {
                content.classList.remove('active');
                content.style.display = 'none';
            });
            const targetContent = document.getElementById(targetTab + '-content');
            targetContent.classList.add('active');
            targetContent.style.display = 'flex';
        });
    });
    inventoryModal.addEventListener('click', function(event) {
        if (event.target === inventoryModal) {
            inventoryModal.style.display = 'none';
            itemMenu.style.display = 'none';
        }
    });
    modalNewsBtn.addEventListener('click', function(event) {
        event.stopPropagation();
        welcomeModal.style.display = 'none';
        newsModal.style.display = 'flex';
        showPage(1);
    });
    shopNewsBtn.addEventListener('click', function(event) {
        event.stopPropagation();
        marketModal.style.display = 'none';
        newsModal.style.display = 'flex';
        showPage(1);
    });
    closeWelcomeModalBtn.addEventListener('click', function(event) {
        event.stopPropagation();
        welcomeModal.style.display = 'none';
    });
    mapBtn.addEventListener('click', function(event) {
        event.stopPropagation();
        mapModal.style.display = 'flex';
        mapScale = 1;
        updateMapTransform();
        lighthouseText.classList.add('current-location');
        marketText.classList.remove('current-location');
    });

    zoomInBtn.addEventListener('click', function(event) {
        event.stopPropagation();
        zoomIn();
    });

    zoomOutBtn.addEventListener('click', function(event) {
        event.stopPropagation();
        zoomOut();
    });

    const closeMapModalBtn = document.getElementById('close-map-modal-btn');
    closeMapModalBtn.addEventListener('click', function() {
        mapModal.style.display = 'none';
    });
    const marketText = document.getElementById('market-text');
    marketText.addEventListener('click', function(event) {
        event.stopPropagation();
        window.location.href = 'play.html';
    });
    const lighthouseText = document.getElementById('lighthouse-text');
    lighthouseText.addEventListener('click', function(event) {
        event.stopPropagation();
        window.location.href = 'play-2.html';
    });
    function showPage(pageNum) {
        currentPage = pageNum;
        if (pageNum === 1) {
            newsPage1.style.display = 'flex';
            newsPage2.style.display = 'none';
            prevPageBtn.style.display = 'none';
            nextPageBtn.style.display = 'block';
            pageDot1.style.background = 'white';
            pageDot2.style.background = 'rgba(255,255,255,0.5)';
        } else if (pageNum === 2) {
            newsPage1.style.display = 'none';
            newsPage2.style.display = 'flex';
            prevPageBtn.style.display = 'block';
            nextPageBtn.style.display = 'none';
            pageDot1.style.background = 'rgba(255,255,255,0.5)';
            pageDot2.style.background = 'white';
        }
    }
    nextPageBtn.addEventListener('click', function() {
        if (currentPage < 2) {
            showPage(currentPage + 1);
        }
    });
    prevPageBtn.addEventListener('click', function() {
        if (currentPage > 1) {
            showPage(currentPage - 1);
        }
    });
    const closeModalBtn = document.getElementById('close-modal-btn');
    closeModalBtn.addEventListener('click', function() {
        newsModal.style.display = 'none';
    });
    newsModal.addEventListener('click', function(event) {
        if (event.target === newsModal) {
            newsModal.style.display = 'none';
        }
    });
    const moveSpeed = 300; 
    const keysPressed = {};
    function updateMovement() {
        const rect = meeple.getBoundingClientRect();
        let deltaX = 0;
        let deltaY = 0;
        const currentSpeed = keysPressed['Shift'] ? moveSpeed * 2 : moveSpeed;
        if (keysPressed['w'] || keysPressed['W']) deltaY -= currentSpeed / 60;
        if (keysPressed['s'] || keysPressed['S']) deltaY += currentSpeed / 60;
        if (keysPressed['a'] || keysPressed['A']) deltaX -= currentSpeed / 60;
        if (keysPressed['d'] || keysPressed['D']) deltaX += currentSpeed / 60;
        if (deltaX !== 0 || deltaY !== 0) {
            const targetX = rect.left + deltaX;
            const targetY = rect.top + deltaY;
            moveMeeple(targetX, targetY);
        }
        requestAnimationFrame(updateMovement);
    }
    document.addEventListener('keydown', function(event) {
        const key = event.key.toLowerCase();
        if (key.match(/[wasd]/)) {
            keysPressed[event.key] = true;
            event.preventDefault();
        }
        if (event.key === 'Shift') {
            keysPressed['Shift'] = true;
        }
    });
    document.addEventListener('keyup', function(event) {
        const key = event.key.toLowerCase();
        if (key.match(/[wasd]/)) {
            delete keysPressed[event.key];
            event.preventDefault();
        }
        if (event.key === 'Shift') {
            delete keysPressed['Shift'];
        }
    });
    updateMovement();
    window.addEventListener('resize', function() {
        const playerWidth = 256;
        const playerHeight = 256;
        const meepleRect = meeple.getBoundingClientRect();
        let newLeft = parseFloat(meeple.style.left) || meepleRect.left;
        let newTop = parseFloat(meeple.style.top) || meepleRect.top;
        newLeft = Math.max(0, Math.min(newLeft, window.innerWidth - playerWidth));
        newTop = Math.max(0, Math.min(newTop, window.innerHeight - playerHeight));
        meeple.style.left = newLeft + 'px';
        meeple.style.top = newTop + 'px';
        if (currentlyEquippedItem) {
            equippedHat.style.left = (newLeft + meeple.clientWidth / 2 - 32) + 'px';
            equippedHat.style.top = (newTop + 10) + 'px';
        }
    });
    document.addEventListener('click', function(event) {
        if (playerMenu.style.display === 'block' && !playerMenu.contains(event.target) && event.target !== meeple) {
            playerMenu.style.display = 'none';
        }
        const isButton = event.target.tagName === 'BUTTON' || event.target.closest('button');
        const isInteractive = event.target === meeple || event.target === inventoryBtn;
        const isItemMenu = event.target.closest('#item-menu');
        if (!isButton && !isInteractive && !isItemMenu) {
            const rect = meeple.getBoundingClientRect();
            let targetX = event.clientX - 128;
            let targetY = event.clientY - 128;
            moveMeeple(targetX, targetY);
        }
    });
});
document.addEventListener('contextmenu',e=>{e.preventDefault();const m=document.createElement('div');m.innerHTML=`<div style="position:fixed;top:${e.clientY}px;left:${e.clientX}px;background:#333;color:#fff;padding:10px;border-radius:8px;z-index:9999;font-family:'Fredoka One',cursive;font-size:14px;box-shadow:0 4px 12px rgba(0,0,0,0.5);"><div style="margin-bottom:8px;"><b>Navigation</b></div><div onclick="window.location.href='/index.html'" style="cursor:pointer;padding:4px 8px;border-radius:4px;margin:2px 0;">üè† Home</div><div onclick="window.location.href='/play.html'" style="cursor:pointer;padding:4px 8px;border-radius:4px;margin:2px 0;">üè∞ Castle</div><div onclick="window.location.href='/arcade-menu.html'" style="cursor:pointer;padding:4px 8px;border-radius:4px;margin:2px 0;">üéÆ Arcade</div><div onclick="window.location.href='/fishing-frenzy-menu.html'" style="cursor:pointer;padding:4px 8px;border-radius:4px;margin:2px 0;">üé£ Fishing</div>`;document.body.appendChild(m);setTimeout(()=>{m.remove()},5000);document.addEventListener('click',()=>m.remove(),{once:true})});
</script>