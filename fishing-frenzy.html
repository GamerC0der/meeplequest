<!DOCTYPE html>
<html>
<head>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&display=swap" rel="stylesheet">
    <style>
        body {
            background: url(/static/beach.png) center/cover fixed;
            margin: 0; padding: 0; min-height: 100vh;
            font-family: 'Fredoka One', cursive;
            image-rendering: pixelated;
            overflow: hidden;
        }
        #display {
            position: absolute; top: 2rem; right: 2rem;
            background: rgba(0,0,0,0.8); color: white; padding: 1rem;
            border-radius: 10px; font-size: 1.5rem; z-index: 30;
        }
        #fish {
            position: absolute; font-size: 4rem; z-index: 10;
            pointer-events: none; user-select: none;
        }
    </style>
</head>
<body>
    <div id="display">Coins: <span id="score">0</span><br>Time: <span id="time">15</span></div>

    <div id="game-over-modal" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.9); z-index: 1000; justify-content: center; align-items: center;">
        <div style="background: url(/static/textbg.png) center/cover; padding: 2rem; border-radius: 20px; text-align: center; max-width: 400px; width: 90%; image-rendering: pixelated;">
            <h2 style="color: #8B4513; font-family: 'Georgia', serif; font-size: 2.5rem; font-weight: bold; text-transform: uppercase; margin: 0 0 1rem 0; text-shadow: 3px 3px 6px rgba(0,0,0,0.9); -webkit-text-stroke: 1px #2F1B14;">Time's Up!</h2>
            <p style="color: #2F1B14; font-family: 'Times New Roman', serif; font-size: 1.2rem; margin-bottom: 1rem;">Coins earned: <strong style="color: #FFD700;"><span id="final-coins">0</span></strong></p>
            <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 1rem;">
                <button id="play-again-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 1rem 2rem; font-family: 'Georgia', serif; font-size: 1.2rem; font-weight: bold; cursor: pointer;">Play Again</button>
                <button id="back-to-hub-btn" style="background: rgba(0,0,0,0.8); color: white; border: 2px solid #8B4513; border-radius: 8px; padding: 1rem 2rem; font-family: 'Georgia', serif; font-size: 1.2rem; font-weight: bold; cursor: pointer;">Back to Hub</button>
            </div>
        </div>
    </div>
    <script>
        let score = 0, time = 15, gameOver = false, fishCount = 3;
        document.getElementById('score').textContent = score;
        document.getElementById('time').textContent = time;

        const fishEmojis = ['üêü', 'üê†'];
        const fishes = [];
        for (let i = 0; i < fishCount; i++) {
            const fish = document.createElement('div');
            const isTrash = Math.random() < 0.1;
            fish.textContent = isTrash ? 'üóëÔ∏è' : fishEmojis[Math.floor(Math.random() * fishEmojis.length)];
            fish.style.cssText = 'position: absolute; font-size: 4rem; z-index: 10; pointer-events: none; user-select: none;';
            document.body.appendChild(fish);
            fishes.push({
                element: fish,
                x: Math.random() * (window.innerWidth - 100) + 50,
                y: Math.random() * (window.innerHeight - 100) + 50,
                directionX: (Math.random() - 0.5) * 4,
                directionY: (Math.random() - 0.5) * 4,
                isTrash: isTrash
            });
        }

        function moveFishes() {
            if (gameOver) return;
            fishes.forEach(fish => {
                fish.x += fish.directionX;
                fish.y += fish.directionY;
                if (fish.x <= 0 || fish.x >= window.innerWidth - 50) fish.directionX *= -1;
                if (fish.y <= 0 || fish.y >= window.innerHeight - 50) fish.directionY *= -1;
                fish.element.style.left = fish.x + 'px';
                fish.element.style.top = fish.y + 'px';
            });
            requestAnimationFrame(moveFishes);
        }
        moveFishes();

        setInterval(() => {
            if (!gameOver && --time <= 0) {
                gameOver = true;
                endGame();
            }
            document.getElementById('time').textContent = time;
        }, 1000);

        function endGame() {
            fishes.forEach(fish => fish.element.remove());

            const currentTotal = parseInt(localStorage.getItem('totalCoins') || '0');
            const newTotal = currentTotal + score;
            localStorage.setItem('totalCoins', newTotal.toString());

            document.getElementById('final-coins').textContent = score;
            document.getElementById('game-over-modal').style.display = 'flex';
            document.getElementById('game-over-modal').style.justifyContent = 'center';
            document.getElementById('game-over-modal').style.alignItems = 'center';

            document.getElementById('play-again-btn').addEventListener('click', () => {
                location.reload();
            });

            document.getElementById('back-to-hub-btn').addEventListener('click', () => {
                window.location.href = '/play-2.html';
            });
        }

        document.addEventListener('click', (e) => {
            if (!gameOver) {
                fishes.forEach((fish, index) => {
                    const rect = fish.element.getBoundingClientRect();
                    if (e.clientX >= rect.left && e.clientX <= rect.right &&
                        e.clientY >= rect.top && e.clientY <= rect.bottom) {
                        if (fish.isTrash) {
                            time = Math.max(0, time - 5);
                            document.getElementById('time').textContent = time;
                        } else {
                            score++;
                            document.getElementById('score').textContent = score;
                            fish.element.textContent = fishEmojis[Math.floor(Math.random() * fishEmojis.length)];
                        }
                        fish.x = Math.random() * (window.innerWidth - 100) + 50;
                        fish.y = Math.random() * (window.innerHeight - 100) + 50;
                        fish.directionX = (Math.random() - 0.5) * 4;
                        fish.directionY = (Math.random() - 0.5) * 4;
                    }
                });
            }
        });
    </script>
</body>
</html>
